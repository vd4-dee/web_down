<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row =>
                    row.some(cell => cell !== '' && cell !== null && cell !== undefined)
                );

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Downloader</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body style="display:flex;min-height:100vh;margin:0;background:#F8F9FA;font-family:'Roboto',sans-serif;">
    <aside style="width:220px;background:#EDEFF2;display:flex;flex-direction:column;align-items:center;padding:32px 0;position:fixed;height:100vh;">
        <h2 style="font-size:24px;color:#00A1B7;margin-bottom:32px;font-weight:600;">Menu</h2>
        <nav style="width:100%;">
            <ul style="list-style:none;padding:0;margin:0;">
                <li><a href="{{ url_for('index') }}" style="display:block;padding:12px 32px;color:#333333;font-size:16px;text-decoration:none;font-weight:500;border-radius:6px;margin:0 16px 8px;background:#E5E7EB;">Download</a></li>
                <li><a href="{{ url_for('email.index') }}" style="display:block;padding:12px 32px;color:#333333;font-size:16px;text-decoration:none;font-weight:500;border-radius:6px;margin:0 16px;">Email</a></li>
            </ul>
        </nav>
    </aside>
    <main style="flex:1;padding:40px 5vw;margin-left:220px;">
        <div id="notification" style="display:none;background:#fff;border-radius:8px;padding:16px;box-shadow:0 2px 8px #0001;position:fixed;top:16px;right:16px;color:#333333;font-size:14px;">New items saved</div>
        <section style="margin-bottom:32px;">
            <h2 style="font-size:24px;color:#333333;font-weight:600;margin-bottom:24px;">Recommended</h2>
            <div style="display:flex;flex-wrap:wrap;gap:16px;">
                <div style="background:#fff;border-radius:8px;padding:24px;box-shadow:0 2px 8px #0001;width:200px;text-align:center;">
                    <i class="fas fa-download" style="font-size:24px;color:#00A1B7;margin-bottom:16px;"></i>
                    <div style="font-size:18px;color:#333333;font-weight:500;margin-bottom:16px;">Download Reports</div>
                    <a href="#main-download-panel" class="card-button" style="background:#00A1B7;color:#fff;padding:8px 16px;border-radius:6px;text-decoration:none;font-size:14px;">Open</a>
                </div>
                <div style="background:#fff;border-radius:8px;padding:24px;box-shadow:0 2px 8px #0001;width:200px;text-align:center;">
                    <i class="fas fa-envelope" style="font-size:24px;color:#00A1B7;margin-bottom:16px;"></i>
                    <div style="font-size:18px;color:#333333;font-weight:500;margin-bottom:16px;">Bulk Email</div>
                    <a href="{{ url_for('email.index') }}" class="card-button" style="background:#00A1B7;color:#fff;padding:8px 16px;border-radius:6px;text-decoration:none;font-size:14px;">Open</a>
                </div>
                <div style="background:#fff;border-radius:8px;padding:24px;box-shadow:0 2px 8px #0001;width:200px;text-align:center;">
                    <i class="fas fa-calendar-alt" style="font-size:24px;color:#00A1B7;margin-bottom:16px;"></i>
                    <div style="font-size:18px;color:#333333;font-weight:500;margin-bottom:16px;">Schedule Download</div>
                    <a href="#scheduling" class="card-button" style="background:#00A1B7;color:#fff;padding:8px 16px;border-radius:6px;text-decoration:none;font-size:14px;">Open</a>
                </div>
                <div style="background:#fff;border-radius:8px;padding:24px;box-shadow:0 2px 8px #0001;width:200px;text-align:center;">
                    <i class="fas fa-history" style="font-size:24px;color:#00A1B7;margin-bottom:16px;"></i>
                    <div style="font-size:18px;color:#333333;font-weight:500;margin-bottom:16px;">Download History</div>
                    <a href="#log-panel" class="card-button" style="background:#00A1B7;color:#fff;padding:8px 16px;border-radius:6px;text-decoration:none;font-size:14px;">Open</a>
                </div>
            </div>
        </section>
        <section>
            <h2 style="font-size:24px;color:#333333;font-weight:600;margin-bottom:16px;">Recent Downloads</h2>
            <div style="display:flex;gap:8px;margin-bottom:16px;">
                <input type="text" id="table-search" placeholder="Search by keyword" style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:200px;">
                <button style="padding:8px 16px;background:#fff;border:1px solid #E5E7EB;border-radius:6px;color:#00A1B7;font-size:14px;">Filter</button>
            </div>
            <table style="width:100%;border-collapse:collapse;background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px #0001;">
                <thead>
                    <tr style="background:#F8F9FA;">
                        <th style="padding:12px;font-size:14px;color:#333333;font-weight:600;text-align:left;">Name</th>
                        <th style="padding:12px;font-size:14px;color:#333333;font-weight:600;text-align:left;">Type</th>
                        <th style="padding:12px;font-size:14px;color:#333333;font-weight:600;text-align:left;">Time</th>
                        <th style="padding:12px;font-size:14px;color:#333333;font-weight:600;text-align:left;">Status</th>
                    </tr>
                </thead>
                <tbody id="log-table-body">
                    <!-- Populated by JS -->
                </tbody>
            </table>
        </section>
        <section id="main-download-panel" style="margin-top:48px;">
            <h2 style="font-size:24px;color:#333333;font-weight:600;margin-bottom:24px;">Download Configuration</h2>
            <div style="background:#fff;border-radius:8px;padding:32px;box-shadow:0 2px 8px #0001;">
                <div style="margin-bottom:30px;">
                    <h3 style="font-size:18px;color:#333333;font-weight:500;margin-bottom:16px;">Configuration Management</h3>
                    <div style="margin-bottom:16px;">
                        <label style="display:block;font-size:14px;color:#333333;margin-bottom:8px;">Configuration Name:</label>
                        <input type="text" id="config-name" placeholder="E.g., Monthly Reports" style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:300px;">
                        <button id="save-config-button" style="padding:8px 16px;background:#00A1B7;color:#fff;border:none;border-radius:6px;font-size:14px;margin-left:8px;">Save</button>
                    </div>
                    <div>
                        <label style="display:block;font-size:14px;color:#333333;margin-bottom:8px;">Load/Delete Config:</label>
                        <select id="saved-configs-dropdown" style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:300px;">
                            <option value="">-- Select Configuration --</option>
                        </select>
                        <button id="load-config-button" style="padding:8px 16px;background:#00A1B7;color:#fff;border:none;border-radius:6px;font-size:14px;margin-left:8px;">Load</button>
                        <button id="delete-config-button" style="padding:8px 16px;background:#dc3545;color:#fff;border:none;border-radius:6px;font-size:14px;margin-left:8px;">Delete</button>
                    </div>
                </div>
                <div style="margin-bottom:30px;">
                    <h3 style="font-size:18px;color:#333333;font-weight:500;margin-bottom:16px;">Download Settings</h3>
                    <form id="download-form">
                        <div style="margin-bottom:16px;">
                            <label style="display:block;font-size:14px;color:#333333;margin-bottom:8px;">Email:</label>
                            <input type="text" id="email" name="email" value="{{ default_email or '' }}" required style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:300px;">
                        </div>
                        <div style="margin-bottom:16px;">
                            <label style="display:block;font-size:14px;color:#333333;margin-bottom:8px;">Password:</label>
                            <input type="password" id="password" name="password" value="{{ default_password or '' }}" required style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:300px;">
                        </div>
                        <table id="report-table" style="width:100%;border-collapse:collapse;margin-bottom:16px;">
                            <thead>
                                <tr style="background:#F8F9FA;">
                                    <th style="padding:12px;font-size:14px;color:#333333;font-weight:600;text-align:left;border-bottom:1px solid #E5E7EB;">Report Name</th>
                                    <th style="padding:12px;font-size:14px;color:#333333;font-weight:600;text-align:left;border-bottom:1px solid #E5E7EB;">From Date</th>
                                    <th style="padding:12px;font-size:14px;color:#333333;font-weight:600;text-align:left;border-bottom:1px solid #E5E7EB;">To Date</th>
                                    <th style="padding:12px;font-size:14px;color:#333333;font-weight:600;text-align:left;border-bottom:1px solid #E5E7EB;">Chunk Size</th>
                                    <th style="padding:12px;font-size:14px;color:#333333;font-weight:600;text-align:left;border-bottom:1px solid #E5E7EB;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding:12px;border-bottom:1px solid #E5E7EB;">
                                        <select name="report_type[]" class="report-type-select" required style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:100%;">
                                            <option value="">-- Select Report --</option>
                                        </select>
                                    </td>
                                    <td style="padding:12px;border-bottom:1px solid #E5E7EB;"><input type="date" name="from_date[]" required style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:100%;"></td>
                                    <td style="padding:12px;border-bottom:1px solid #E5E7EB;"><input type="date" name="to_date[]" required style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:100%;"></td>
                                    <td style="padding:12px;border-bottom:1px solid #E5E7EB;"><input type="text" name="chunk_size[]" value="5" style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:100%;"></td>
                                    <td style="padding:12px;border-bottom:1px solid #E5E7EB;"><button type="button" class="remove-row-button" style="padding:8px 16px;background:#dc3545;color:#fff;border:none;border-radius:6px;font-size:14px;">Remove</button></td>
                                </tr>
                            </tbody>
                        </table>
                        <button type="button" id="add-row-button" style="padding:8px 16px;background:#00A1B7;color:#fff;border:none;border-radius:6px;font-size:14px;">Add Report</button>
                        <div id="region-selection" style="display:none;margin-top:16px;">
                            <label style="display:block;font-size:14px;color:#333333;margin-bottom:8px;">Select Region(s):</label>
                        </div>
                        <button type="submit" id="download-button" style="padding:8px 16px;background:#00A1B7;color:#fff;border:none;border-radius:6px;font-size:14px;margin-top:16px;">Download All</button>
                        <span id="loading-indicator" style="display:none;font-size:14px;color:#6B7280;margin-left:8px;">Processing...</span>
                    </form>
                </div>
                <div>
                    <h3 style="font-size:18px;color:#333333;font-weight:500;margin-bottom:16px;">Progress Status</h3>
                    <div id="status-messages" style="background:#F8F9FA;border-radius:6px;padding:16px;min-height:100px;font-size:14px;color:#333333;">
                        <p>No activity yet.</p>
                    </div>
                </div>
            </div>
        </section>
        <section id="scheduling" style="margin-top:48px;display:none;">
            <h2 style="font-size:24px;color:#333333;font-weight:600;margin-bottom:24px;">Schedule Download</h2>
            <div style="background:#fff;border-radius:8px;padding:32px;box-shadow:0 2px 8px #0001;">
                <div style="margin-bottom:16px;">
                    <label style="display:block;font-size:14px;color:#333333;margin-bottom:8px;">Select Config:</label>
                    <select id="schedule-config-select" style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:300px;">
                        <option value="">-- Select Saved Config --</option>
                    </select>
                </div>
                <div style="margin-bottom:16px;">
                    <label style="display:block;font-size:14px;color:#[*]color:#333333;margin-bottom:8px;">Run At (Date & Time):</label>
                    <input type="datetime-local" id="schedule-datetime" style="padding:8px;font-size:14px;border:1px solid #E5E7EB;border-radius:6px;width:300px;">
                </div>
                <button id="schedule-button" style="padding:8px 16px;background:#00A1B7;color:#fff;border:none;border-radius:6px;font-size:14px;">Schedule Job</button>
                <h3 style="font-size:18px;color:#333333;font-weight:500;margin:24px 0 16px;">Active Schedules:</h3>
                <ul id="schedules-list" style="list-style:none;padding:0;">
                    <li style="font-size:14px;color:#6B7280;">Loading schedules...</li>
                </ul>
            </div>
        </section>
    </main>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>